<script type="text/javascript" src="/js/jquery-ui-1.9.2.custom.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>
<form name="f2">
    <div id="Proyecto_Activa">
    <a href="/proyecto/index/asignaractividad/proyectoid/<?php echo $this->proyectoid ?>/codigo_prop_proy/<?php echo $this->codigo_prop_proy ?>/areaid/<?php echo $this->areaid ?>"> </a>
    <table class="table p-table" style="padding: 1px;">
        <thead>
            <tr>  
                <th style="width: 250px;">
                    Actividades
                </th>
                <?php
                $c=0;
                
                $cont=count($this->actividades);
                // $f=0;
                // $cont=0;
                // foreach ($this->actividades as $listaactividad)
                // {
                //   if(strlen($listaactividad['actividadid'])>1)
                //   {
                //     //print_r(strlen($listaactividad['actividadid']));
                //     $cont=$cont+1;
                //   }
                //   $f++;
                // }
                //print_r($cont);

                foreach ($this->equipo as $listaequipo) 
                    {?>
                    <th style="width: 50px;padding-top: 1px;padding-right: 1px;padding-bottom: 1px;padding-left: 1px;" style="width: 150px; font-size: 10px;" class="p-name" id="nomact_<?php echo $c?>">
                        <a href="#"><?php //echo $listaequipo['uid'];

                          $porciones = explode(".", $listaequipo['uid']);
                          echo (ucwords($porciones[0])); echo " ";echo (ucwords($porciones[1]));

                        ?></a>

                        <?php
                            $codigo_prop_proy=$listaequipo['codigo_prop_proy'];
                            $proyectoid=$listaequipo['proyectoid'];
                            $uid=$listaequipo['uid'];
                            $dni=$listaequipo['dni'];
                            $estado='A';
                            $areaid=$listaequipo['areaid'];
                            $categoriaid=$listaequipo['categoriaid'];
                            $acti= new Admin_Model_DbTable_Activaractividad();
                            $activr= $acti-> _getConteoactivar($codigo_prop_proy,$proyectoid,$uid,$dni,$estado,$areaid,$categoriaid);
                            //print_r($activr);
                        ?>
                        <?php
                            
                            if($cont==$activr[0]['count'])
                                { ?>
                                    <input name="todoagrega" id="todoagrega_<?php echo $c ?>" value="A_<?php echo $c?>" type="checkbox" checked>
                         <?php }
                            else
                                { ?>
                                    <input name="todoagrega" id="todoagrega_<?php echo $c ?>" value="A_<?php echo $c?>" type="checkbox" >
                        <?php  }
                        ?>               
                        <script type="text/javascript"> 
                            $("#todoagrega_<?php echo $c ?>").click(function(){
                                var j="<?php echo $c ?>";
                                var toten="<?php echo $cont ?>";
                                if($("#todoagrega_<?php echo $c?>").is(':checked')) 
                                {  
                                    for (i = 0; i < toten; i++){          
                                        document.getElementById("agrega_"+i+j).checked=1;
                                    }
                                    estado='A';
                                    console.log('act');                   
                                } else {    
                                    for (i = 0; i < toten; i++){      
                                        document.getElementById("agrega_"+i+j).checked=0;
                                    }
                                    estado='I';
                                    console.log('desact'); 
                                }
                                var codigo_prop_proy="<?php echo $listaequipo['codigo_prop_proy'] ?>";
                                var cargo="<?php echo $listaequipo['cargo'] ?>";
                                var areaid="<?php echo $listaequipo['areaid'] ?>";
                                var uid="<?php echo $listaequipo['uid'] ?>";
                                var dni="<?php echo $listaequipo['dni'] ?>";
                                var proyectoid="<?php echo $listaequipo['proyectoid'] ?>";
                                var categoriaid="<?php echo $listaequipo['categoriaid'] ?>";
                                var areaid="<?php echo $listaequipo['areaid'] ?>";
                                var cargo="<?php echo $listaequipo['cargo'] ?>";   
                                url="/proyecto/index/agregartodoactividad/cargo/"+cargo+"/areaid/"+areaid+"/uid/"+uid+"/dni/"+dni+"/proyectoid/"+proyectoid+"/categoriaid/"+ categoriaid+"/codigo_prop_proy/"+codigo_prop_proy+"/estado/"+estado;       
                                $.ajax({
                                    type: "POST",
                                    url: url,
                                    data: $(this).serialize(),
                                    dataType: "html",
                                    success: function(data)
                                    {                                     
                                      
                                    }
                                });
                            });
                        </script>
                    </th>                                            
                <?php $c++; } ?>
            </tr>
        </thead>
        <tbody style="font-size: 10px;">
        <?php
            $c=0;
            foreach ($this->actividades as $listaactividad)
                {         
                ?>
                <tr>
                    <td style="width: 50px;padding-top: 1px;padding-right: 1px;padding-bottom: 1px;padding-left: 1px;" style="width: 150px; font-size: 10px;" id="nomact_<?php echo $c?>">                    
                        <?php echo "<strong>"; echo $listaactividad['actividadid']; echo "</strong>"; echo " -  "; echo $listaactividad['nombre']; ?>
                        <?php echo strlen($listaactividad['actividadid']) ?>
                    </td>  

                     <?php
                       $i=0;              
                      //foreach ($this->actividades as $listaactividad)
                       foreach ($this->equipo as $listaequipo) 
                      {
                        $wheres=array('codigo_prop_proy'=>$listaactividad['codigo_prop_proy'],'codigo_actividad'=>$listaactividad['codigo_actividad'],'proyectoid'=>$listaequipo['proyectoid'],'actividadid'=>$listaactividad['actividadid'],'uid'=>$listaequipo['uid'],'dni'=>$listaequipo['dni'],'cargo'=>$listaequipo['cargo'],'areaid'=>$listaequipo['areaid'],'categoriaid'=>$listaequipo['categoriaid']);

                        $act= new Admin_Model_DbTable_Activaractividad();
                        $activar= $act->_getOne($wheres);
                        //  print_r($activar);
                      ?>
                        <td style="width: 150px;padding-top: 1px;padding-right: 1px;padding-bottom: 1px;padding-left: 1px;" >
                          <?php
                          if($activar['estado']=='A' )
                          {  
                            if(strlen($activar['actividadid'])>1)
                            {
                              //print_r(strlen($activar['actividadid']));
                             ?>
                              <input id="agrega_<?php echo $c?><?php echo $i?>" type="checkbox"  checked="checked" name="agreg[<?php echo $c?>][<?php echo $i?>]" value="<?php echo $i ?><?php echo $c ?>">
                            <?php }
                            else
                            { ?>
                              <input  id="agrega_<?php echo $c?><?php echo $i?>" type="checkbox"  checked="checked" name="agreg[<?php echo $c?>][<?php echo $i?>]" value="<?php echo $i ?><?php echo $c ?>">
                            <?php }
                    
                       
                          }
                          else
                          { 
                            if(strlen($listaactividad['actividadid'])>1)
                            { ?>
                               <input id="agrega_<?php echo $c?><?php echo $i?>" type="checkbox" name="agreg[<?php echo $c?>][<?php echo $i?>]" value="<?php echo $i ?><?php echo $c ?>" >
                            <?php }
                            else
                            { //print_r(strlen($activar['actividadid'])); ?>
                               <input id="agrega_<?php echo $c?><?php echo $i?>" type="checkbox" name="agreg[<?php echo $c?>][<?php echo $i?>]" value="<?php echo $i ?><?php echo $c ?>" >
                            <?php }                            
                         
                          }
                          ?>

                            <script type="text/javascript">
                                var checkboxValues = "";
                                $('input[name="agreg[]"]:checked').each(function() {
                                    checkboxValues += $(this).val() + ",";
                                });
                                //eliminamos la última coma.
                                checkboxValues = checkboxValues.substring(0, checkboxValues.length-1);
                                //si todos los checkbox están seleccionados devuelve 1,2,3,4,5
                                console.log(checkboxValues);
                            </script>

                            <script type="text/javascript">                         
                                $("#agrega_<?php echo $c?><?php echo $i?>").click(function(){ 
                                //alert("<?php echo $c?><?php echo $i ?>");
                                if($("#agrega_<?php echo $c?><?php echo $i?>").is(':checked')) {  
                                    estado='A';
                                    console.log('act'); 
                                } else {    
                                    estado='I';
                                    console.log('desact'); 
                                }
                                var cargo="<?php echo $listaequipo['cargo'] ?>";
                                var areaid="<?php echo $listaequipo['areaid'] ?>";
                                var uid="<?php echo $listaequipo['uid'] ?>";
                                var dni="<?php echo $listaequipo['dni'] ?>";
                                var proyectoid="<?php echo $listaequipo['proyectoid'] ?>";
                                var categoriaid="<?php echo $listaequipo['categoriaid'] ?>";
                                var areaid="<?php echo $listaequipo['areaid'] ?>";
                                var cargo="<?php echo $listaequipo['cargo'] ?>";
                                var actividadid="<?php echo $listaactividad['actividadid'] ?>";
                                var revision="<?php echo $listaactividad['revision'] ?>";
                                var actividad_padre="<?php echo $listaactividad['actividad_padre'] ?>";
                                var codigo_actividad="<?php echo $listaactividad['codigo_actividad'] ?>";
                                var codigo_prop_proy="<?php echo $listaactividad['codigo_prop_proy'] ?>";
                                url="/proyecto/index/agregaactividad/cargo/"+cargo+"/areaid/"+areaid+"/uid/"+uid+"/dni/"+dni+"/proyectoid/"+proyectoid+"/categoriaid/"+ categoriaid+"/actividadid/"+actividadid+"/revision/"+revision+"/actividad_padre/"+actividad_padre+"/codigo_actividad/"+codigo_actividad+"/codigo_prop_proy/"+codigo_prop_proy+"/estado/"+estado;
                                //alert(url);
                                $.ajax({
                                    type: "POST",
                                    url: url,
                                    data: $(this).serialize(),
                                    dataType: "html",                                                 
                                    // error: function(){
                                    //   alert("error petición ajax load");
                                    // },
                                    success: function(data){
                                    }
                              });
                           });                   
                          </script>
                        </td>
                     <?php
                      $i++;
                      }                                 
                     ?>
                </tr>
                <?php $c++;
            }            
          ?>
          </tbody>
    </table>
  </div>
  <div id="cargact"></div>
</form>