<section class="panel">
  <div class="col-lg-2 alert-info"  style="padding-top: 10px;padding-bottom: 10px;padding-right: 10px;padding-left: 10px;">
   <strong>Semana <?php echo $this->semana; echo ": ";?></strong>
    <?php
      $fecha = $this->fecha;
      $newDate = date("Y-m-d", strtotime($fecha));
      $fechainicio = date ( 'd/m/Y' , strtotime($fecha) );
      $nuevafecha = strtotime ( '+6 day' , strtotime ( $newDate ) ) ;
      $fechafinal = date ( 'd/m/Y' , $nuevafecha );
      echo "<br>";
      echo $fechainicio; echo " al "; echo $fechafinal;?>
      <br>
      <?php 
      $sumahorassemana = new Admin_Model_DbTable_Sumahorasemana();
      $wheres=array('dni'=>$this->dni,'uid'=>$this->uid,'semanaid'=>$this->semana);
      $tareosemana=$sumahorassemana->_getOne($wheres);
      $estado_horas=$tareosemana['estado'];
      $estado_real=$tareosemana['estado_real'];
      ?>

      <?php if (trim($estado_horas)=='P' or trim($estado_horas)=='2.B0' or trim($estado_horas)=='3.B1') {?>
        <strong>Hoja de Tiempo Espera de Aprobacion</strong> 
      <?php }?>
      <?php if (trim($estado_horas)=='0' and trim($estado_horas)=='' ) {?>
        <strong>Hoja de Tiempo Rechazada por Jeje Area</strong> 
      <?php }?>
        <?php if (trim($estado_real)=='RECHAZADO' and trim($estado_horas)=='0' ) {?>
      <strong>Hoja de Tiempo Rechazada por Gerente Proyecto</strong> 
      <?php }?>
      <?php if (trim($estado_real)=='PENDIENTE') {?>
      <strong>Hoja de Tiempo Pendiente Aprobación por otro Gerente Proyecto</strong> 
      <?php }?>
      <?php if (trim($estado_real)=='APROBADO') {?>
      <strong>Hoja de Tiempo Aprobada</strong> 
      <?php }?>
      <?php if (trim($estado_horas)=='1') {?>
      <strong>Hoja de Tiempo Aprobada por Jefe Area, espera Gerente de Proyecto</strong> 
      <?php }?>
       <?php if (trim($estado_horas)=='2' and trim($estado_real)=='APROBADO') {?>
      <strong>Hoja de Tiempo Aprobada</strong> 
      <?php }?>
      <?php if (trim($estado_horas)=='' ) {?>
      <strong>Hoja de Tiempo Activa</strong> 
      <?php }?>
  </div>
  <div class="col-lg-5" style="padding-top: 5px;">
    <button data-toggle="button" class="btn btn-white">
      <?php 
      $tareopersona = new Admin_Model_DbTable_Sumahorasemana();
      $wheres=array('dni'=>$this->dni,'uid'=>$this->uid,'semanaid'=>$this->semana);
      $sumahoras = new Admin_Model_DbTable_Sumahora();
      $sumar=$tareopersona-> _getOne($wheres);
      echo $sumar['billable'];
      echo "<br>"; 
      echo "HH Fact.";
      ?>
    </button>
    
    <button data-toggle="button" class="btn btn-white">
      <?php 
      echo $sumar['nonbillable'];
      echo "<br>";
      echo "HH No Fact.";

      ?>
    </button>
   
    <button data-toggle="button" class="btn btn-white info">
      <?php 
      $sumahorasxact=$sumahoras->_getSumaHorasxActividad($this->uid,$this->dni,$this->semana,'adm');
      print_r($sumahorasxact[0]['sum']);
      echo "<br>";
      echo "HH Anddes";
      ?>
    </button>
    <button data-toggle="button" class="btn btn-white">
      <?php 
      echo $sumar['h_total'];
      echo "<br>";
      echo "HH Total";
      ?>
    </button>
  </div>
  <div class="col-lg-2" style="padding-top: 2px;">

 <?php 
  if ($this->aprobacion)
  {
    $buscar_aprobador=$this->aprobacion;
    $aprobacion = new Admin_Model_DbTable_Aprobacion();
    $wheres=array('idaprobacion'=>$buscar_aprobador,'estado'=>'A');
    $list_aprobacion=$aprobacion->_getOne($wheres); 
    $aprobador= $list_aprobacion['idaprobador'];
    $usuario_cat = new Admin_Model_DbTable_Usuariocategoria();
    $wheres_ucat=array('aprobacion'=>$aprobador,'estado'=>'A','estado_sistema'=>'A');
    $list_aprobador=$usuario_cat->_getOne($wheres_ucat); 
    echo "<strong>";echo "Aprobadores: "; echo "</strong>";echo "<br>";
    if ($list_aprobador){
    $aprobador_usuario = explode(".", $list_aprobador['uid']);
    
    echo (ucwords($aprobador_usuario[0])); echo " ";
    echo (ucwords($aprobador_usuario[1])); echo "<br>";
    }
    $planificacion = new Admin_Model_DbTable_Planificacion();
    $proyectos=$planificacion->_getOnexSemanaxGerenteProyecto($this->semana,$this->uid,$this->dni,$this->areaid);

    foreach ($proyectos as $datos) {
      //print_r($datos['uid']);
      $porciones = explode(".", $datos['uid']);
      echo "GP: ";
      echo (ucwords($porciones[0])); echo " ";
      echo (ucwords($porciones[1])); echo "<br>";
    }
  }
 ?> 
    
    <?php 
/*APROBADORES PARA LOS JEFES DE AREA*/  
  if ($this->cargo=='JEFE' && $this->areaid=!'27' && $this->areaid!='16' ) 
    {
      echo "<strong>"; echo "Aprobadores: "; echo "</strong>"; echo "<br>";
      $usuariocategoria = new Admin_Model_DbTable_Usuariocategoria();
      $datos_usuario=$usuariocategoria->_getGerenteAreaxJefeArea($this->areaid,'GERENTE-AREA');
      if ($datos_usuario)
      {
        $gerente_area = explode(".", $datos_usuario[0]['uid']);
        echo "GA: ";
        echo (ucwords($gerente_area[0])); echo " ";
        echo (ucwords($gerente_area[1])); echo "<br>";
      }   
        $planificacion = new Admin_Model_DbTable_Planificacion();
        $proyectos=$planificacion->_getOnexSemanaxGerenteProyecto($this->semana,$this->uid,$this->dni,$this->areaid);

        foreach ($proyectos as $datos) {
          //print_r($datos['uid']);
          $porciones = explode(".", $datos['uid']);
          echo "GP: ";
          echo (ucwords($porciones[0])); echo " ";
          echo (ucwords($porciones[1])); echo "<br>";
        }
    }
  if ($this->cargo=='EQUIPO' and $this->areaid!='26') 
    {
      $planificacion = new Admin_Model_DbTable_Planificacion();
      $proyectos=$planificacion->_getOnexSemanaxGerenteProyecto($this->semana,$this->uid,$this->dni,$this->area_empresa);
      echo "<strong>"; echo "Aprobadores: "; echo "</strong>"; echo "<br>";
      $usuariocategoria = new Admin_Model_DbTable_Usuariocategoria();
      $datos_usuario=$usuariocategoria->_getCargoxArea($this->area_empresa,'JEFE');
      if ($datos_usuario)
      {
        $jefe_area = explode(".", $datos_usuario[0]['uid']);
        echo "JA: ";
        echo (ucwords($jefe_area[0])); echo " ";
        echo (ucwords($jefe_area[1])); echo "<br>";
        foreach ($proyectos as $datos) {
        //print_r($datos['uid']);
        $porciones = explode(".", $datos['uid']);
        echo "GP: ";
        echo (ucwords($porciones[0])); echo " ";
        echo (ucwords($porciones[1])); echo "<br>";
        }
      }
    }
  ?>
  </div>
  <?php 
    $sumahorassemana = new Admin_Model_DbTable_Sumahorasemana();
    $wheres=array('dni'=>$this->dni,'uid'=>$this->uid,'semanaid'=>$this->semana);
    $tareosemana=$sumahorassemana->_getOne($wheres);
    $estado_horas=$tareosemana['estado'];
  
  ?>
  <div class="panel-body" style="padding-top: 10px;padding-bottom: 0px;">
  <?php if (trim($estado_horas)=='P' or trim($estado_horas)=='1' or trim($estado_horas)=='2' or trim($estado_horas)=='2.B0' or trim($estado_horas)=='3.B1' ) {?>
    <a id = "" class="btn btn-primary pull-right btn-xs"  href="" style="margin-right : 10px">
      <i class="fa fa-print"></i> Imprimir
    </a>
    <a id = "submit_copiar" class="btn btn-default pull-right btn-xs" href="#" style="margin-right : 10px">
      <i class="fa fa-check-square"></i> Copiar 
    </a>
    <?php }?>
  <?php if (trim($estado_horas)!='P' && trim($estado_horas)!='1' && trim($estado_horas)!='2' && trim($estado_horas)!='2.B0' && trim($estado_horas)!='3.B1') {?>
    <a id = "submit_work" class="btn btn-default pull-right btn-xs" href="#" style="margin-right : 10px">
      <i class="fa fa-check-square"></i> Enviar 
    </a><?php }?>
     
  <?php if (trim($estado_horas)!='P' && trim($estado_horas)!='1' && trim($estado_horas)!='2' && trim($estado_horas)!='2.B0' && trim($estado_horas)!='3.B1') {?>
    <!--<a id = "save_work" class="btn btn-info pull-right btn-xs"  style="margin-right : 10px">
      <i class="fa fa-save"></i> Guardar
    </a>-->
    <a id = "save_hours" class="btn btn-info pull-right btn-xs"  style="margin-right : 10px">
      <i class="fa fa-save"></i> Guardar
    </a>

    <?php }?>
  <?php if (trim($estado_horas)!='P' && trim($estado_horas)!='1' && trim($estado_horas)!='2' && trim($estado_horas)!='2.B0' && trim($estado_horas)!='3.B1') {?>
    <a id = "add_work" class="btn btn-success pull-right btn-xs" data-toggle="modal" href="#agregar" style="margin-right : 10px">
      <i class="fa fa-check-square-o"></i> Agregar
    </a><?php }?>
  </div>
  
   

</section>
<div class="row">

<form action="" id="form_time" class="form-horizontal">

  <div class="col-sm-12">
    <section class="panel">
      <div class="panel-body">


        <div class="adv-table tableContainer">
          <table  class="display table table-bordered table-striped scrollTable">
          <thead class="fixedHeader">
            <tr>
            <th style="width: 5%;">  </th>
            <th style="width: 60%;" >Proyecto / Actividad: Tarea</th>
            <th style="width: 10%; padding: 0"><div class="div-celda" style="width: 100px;">Tipo</div></th>
            <th style="width: 10%; padding: 0"><div class="div-celda" style="width: 100px;">Tarea</div></th>
            <?php 
              $fecha = $this->fecha;
              $fecha_mostrar = $this->fecha_mostrar;
              $days_name = array("lun","mar","mié","jue","vie","sáb","dom");
              for ($i=0; $i < 7; $i++) { ?>
              <th style="width: 60px; padding:0;"><center class="div-celda">
                <?php print $days_name[$i] ?> <br><?php 
                  list($dia, $mes, $anio) = split('[/.-]', $fecha);
                  print $dia ?></center></th>
                <?php
                  $newDate = date("Y-m-d", strtotime($fecha));
                  $nuevafecha = strtotime ( '+1 day' , strtotime ( $newDate ) ) ;
                  $fecha = date ( 'd-m-Y' , $nuevafecha );
                }?>
            </tr>
          </thead>
          <tbody id="bodyScroll">
          <?php 
            $fechaactual = $this->fecha;
            $fechaactual = date("Y-m-d", strtotime($fechaactual));
            $actividades = $this->actividades;
            $j=1;
            //for ($k=0; $k < 7; $k++){
              //print_r($actividades);
            foreach ($actividades as $data_tareo)
            { ?>      
            <tr class="gradeX" id ="tr_tareo_<?php echo $j?>">
              <?php if ($data_tareo['estado_tareopersona']!='C') { ?>  
              <td style="width: 5%;"> 
                <?php if ($data_tareo['tipo_actividad']=='G') {?>
                  <a <?php if ($data_tareo['estado_tareopersona']=='C') { ?> disabled <?php }?> id ="crear_tareag_<?php echo $j?>"><i class="fa fa-plus-square-o"></i></a>
                  <a title="Eliminar" id ="eliminar_tareo_<?php echo $j?>" ><i class="fa fa-minus-square-o"></i></a><?php }
                if ($data_tareo['tipo_actividad']=='P') { ?>
                  <a id ="crear_tareag_<?php echo $j?>" ><i class="fa fa-plus-square-o"></i></a>
                  <a <?php if ($data_tareo['estado_tareopersona']=='C') { ?> disabled <?php }?> title="Eliminar" id ="eliminar_tareo_<?php echo $j?>" ><i class="fa fa-minus-square-o"></i></a>                                   
                <?php }?>
                <?php if ($data_tareo['tipo_actividad']=='A') { ?>
                  <a ><i class="fa fa-plus-square-o"></i></a>
                  <a <?php if ($data_tareo['estado_tareopersona']=='C') { ?> disabled <?php }?> title="Eliminar" id ="eliminar_tareo_<?php echo $j?>" ><i class="fa fa-minus-square-o"></i></a>                                   
                <?php }?>
              </td>
              <?php } else {?> 

              <td style="width: 5%;"></td>

              <?php } ?>

             
              <td style="width: 60%;">
                <?php  
                  $buscaunidad = new Admin_Model_DbTable_Unidadminera();
                  $buscanombre_unidad=$buscaunidad->_getUnidadmineraxid($data_tareo['clienteid'],$data_tareo['unidad_mineraid']);
                  if ($buscanombre_unidad)
                    { $unidad_minera=$buscanombre_unidad[0]['nombre']; }
                  else
                    { $unidad_minera =$data_tareo['unidad_mineraid']; }

                echo "<strong>"; echo $data_tareo['proyectoid']; echo "</strong>"; echo " "; echo "<strong>"; echo $unidad_minera; echo "</strong>"; echo " "; echo $data_tareo['nombre_proyecto'];  echo " "; echo $data_tareo['actividadid']; echo " ";echo $data_tareo['nombre'] ?>
              </td>            

              <td style="width: 10%; padding: 0;">
              <div class="div-celda" style="width: 100px;">
                <?php if ($data_tareo['tipo_actividad']=='G') {?>
                  

                  <a <?php if ($data_tareo['estado_tareopersona']=='C') { ?> disabled <?php }?> id ="nofacturable_cambio_<?php echo $j?>" class="btn btn-danger btn-xs ">No Facturable.</a>
                <?php }

                if ($data_tareo['tipo_actividad']=='P'){ ?>
                <a <?php if ($data_tareo['estado_tareopersona']=='C') { ?> disabled <?php }?> id ="facturable_tareo_<?php echo $j?>" class="btn btn-success btn-xs">Facturable</a>
                <a <?php if ($data_tareo['estado_tareopersona']=='C') { ?> disabled <?php }?> id ="nofacturable_tareo_<?php echo $j?>" class="btn btn-danger btn-xs" style="display:none">No Facturable</a>

                <?php }?>
                <?php if ($data_tareo['tipo_actividad']=='A') {?>
                  

                  <a  class="btn btn-info btn-xs ">Anddes</a>
                

                <?php }?>
              </div>
              </td>            

              <td style="width: 10%; padding: 0;"> 
              <div class="div-celda" style="width: 100px;">
                <?php if ($data_tareo['tipo_actividad']=='G') {
                  $dbactividadgeneral= new Admin_Model_DbTable_Actividadgeneral();
                  $datosactgeneral = $dbactividadgeneral->_getActividadgeneralxId($data_tareo['actividad_generalid']);
                 // print_r($datosactgeneral[0]['nombre']) 
                    if ($data_tareo['actividad_generalid']) 
                    { ?>
                        <select <?php if ($data_tareo['estado_tareopersona']=='C') { ?> disabled <?php }?> id="select_generalg_<?php echo $j?>" class="form-control input-sm m-bot15 col-lg-10">                        
                              <option value="<?php echo $data_tareo['actividad_generalid']?>"><?php print_r($datosactgeneral[0]['nombre']) ?></option>
                                  <?php 
                                      $areaid='25';
                                      $actividad_generales = new Admin_Model_DbTable_Actividadgeneral();
                                      $data_generales = $actividad_generales->_getActividadgeneralxArea($areaid);
                                      foreach ($data_generales as $data_tareas)
                                      { ?>
                                      <option value="<?php echo $data_tareas['actividad_generalid']?>"><?php  echo $data_tareas['nombre']?></option>
                                      <?php }?>
                        </select>
                      <?php
                    } 
                    else
                    {
                      ?>
                        <select <?php if ($data_tareo['estado_tareopersona']=='C') { ?> disabled <?php }?> id="select_generalg_<?php echo $j?>" class="form-control input-sm m-bot15 col-lg-10">                        
                          <option value="">Elija Tarea No Facturable</option>
                                      <?php 
                                          $areaid='25';
                                          $actividad_generales = new Admin_Model_DbTable_Actividadgeneral();
                                          $data_generales = $actividad_generales->_getActividadgeneralxArea($areaid);
                                          foreach ($data_generales as $data_tareas) {?>
                                          <option value="<?php echo $data_tareas['actividad_generalid']?>"><?php  echo $data_tareas['nombre']?></option>
                                      <?php }?>
                        </select>
                      <?php 
                    } ?>

                  <?php }

                  if ($data_tareo['tipo_actividad']=='P')
                  {  ?>
                    <div id="tarea_proyecto_<?php echo $j?>" >
                     <?php echo "< none >" ?>
                     </div>
                    <div id="tarea_general_<?php echo $j?>" style="display:none">

                    <select id="select_generalp_<?php echo $j?>" class="form-control input-sm m-bot15 col-lg-10">                        
                              <option <?php if ($data_tareo['estado_tareopersona']=='C') { ?> disabled <?php }?> value="">Seleccione Cliente</option>
                                  <?php 
                                      $areaid='25';
                                      $actividad_generales = new Admin_Model_DbTable_Actividadgeneral();
                                      $data_generales = $actividad_generales->_getActividadgeneralxArea($areaid);
                                      foreach ($data_generales as $data_tareas) {?>
                                      <option value="<?php echo $data_tareas['actividad_generalid']?>"><?php  echo $data_tareas['nombre']?></option>
                                  <?php }?>
                    </select>

                    <?php
                  }?>
              </div>
                
              </td >

              <?php  $fecha = $this->fecha; 
              $fecha = date("Y-m-d", strtotime($fecha));
                for ($i=0; $i < 7; $i++) {
                $proyectoid=$data_tareo['proyectoid'];
                //  echo $proyectoid;echo "<br>";
                $codigo=$data_tareo['codigo_prop_proy'];
                // echo $codigo;echo "<br>";
                $revision=$data_tareo['revision'];
                //   echo $revision;echo "<br>";
                $actividadid=$data_tareo['actividadid'];
                //  echo $actividadid;echo "<br>";
                $actividad_padre=$data_tareo['actividad_padre'];
                //   echo $actividad_padre;echo "<br>";
                $semanaid=$data_tareo['semanaid'];
                $cadena=$data_tareo['etapa'];
                $resultado = str_replace("INICIO", "EJECUCION", $cadena);
                //  echo $semanaid;echo "<br>";
                $fecha_tarea=$fecha;
                // echo $fecha_tarea;echo "<br>";
                $fecha_planificacion=$fecha;
                // echo $fecha_planificacion;echo "<br>";
                $uid=$this->uid;
                // echo $uid;echo "<br>";
                $dni=$this->dni;
                //  echo $dni;echo "<br>";
               
                
                $equipo = new Admin_Model_DbTable_Equipo();
                $estado_usuario='A';
                $data_equipo = $equipo->_getDatosxProyectoxUidXEstadoxCliente($uid,$dni,$estado_usuario,$data_tareo['codigo_prop_proy'],$data_tareo['proyectoid']);
                $categoriaid=$data_equipo[0]['categoriaid'];
                $areaid=$data_equipo[0]['areaid'];
                $cargo=$data_equipo[0]['cargo'];
             

                 //echo $categoriaid; echo "<br>";
                $tareopersona = new Admin_Model_DbTable_Tareopersona();
                $buscar_tarea=$tareopersona->_getTareoxProyectoxTareaxDia($proyectoid,$codigo,$revision,$actividadid,$actividad_padre,$semanaid,$fecha_tarea,$fecha_planificacion,$uid,$dni,$cargo,$resultado);
             
                //print_r($data_tareo);echo "<br>";
                //print_r($buscar_tarea[0]['asignado']);

                //$k=$a[$i][$j];
              if ($data_tareo['tipo_actividad']=='G' and $data_tareo['actividad_generalid']=='')
                {
                ?>
              <td style="width: 60px; padding:0;">
              <div class="div-celda">
                <center>
                   <input disabled  class="form-control focusable" id="valor<?php echo $i?><?php echo $j?>" style="text-align: center;height: 26px; width: 40px; padding-right: 4px; padding-left: 4px;" maxlength="5" values= "<?php  print_r($buscar_tarea[0]['tipo_actividad']) ?>" value="<?php 
                 if ($buscar_tarea) {

                    if($buscar_tarea[0]['h_real']=='0') { echo "";} else { print_r($buscar_tarea[0]['h_real']);}
                    }?>" 
                     >
                     <?php
                       if($buscar_tarea)
                      { 
                        if(trim($buscar_tarea[0]['h_real'])=='' or $buscar_tarea[0]['h_real']=='0' or $buscar_tarea[0]['h_real']==null){
                        }
                        else
                        {
                       ?>
                          <a data-toggle="modal" href="#myModalcomentario"><i class="fa fa-ellipsis-h"></i></a>
                       <?php
                        } 
                      }   
                      ?>
                  </div>
                </center>
              </div>
              </td>

                <?php 
                } else {
                ?>
              <td style="width: 60px; padding:0;">
              <div class="div-celda">
                <center>
                  <div class="btn-group">

                    <input  <?php if ($data_tareo['estado_tareopersona']=='C') { ?> disabled <?php }?>    name="tiempo_id[<?php echo $j ?>][<?php echo $i ?>]" class="form-control focusable" id="valor<?php echo $i?><?php echo $j?>" style="text-align: center;height: 26px; width: 40px; padding-right: 4px; padding-left: 4px;" maxlength="4"  value="<?php 
                    if ($buscar_tarea) {
                      if($buscar_tarea[0]['h_real']=='0') { echo "";} else { print_r($buscar_tarea[0]['h_real']);}
                      }?>" 
                     > 
                    <?php
                      if($buscar_tarea)
                      { 
                        if(trim($buscar_tarea[0]['h_real'])=='' or $buscar_tarea[0]['h_real']=='0' or $buscar_tarea[0]['h_real']==null){
                        }
                        else
                        {
                          if(trim($buscar_tarea[0]['comentario'])=='' or trim($buscar_tarea[0]['comentario'])==null) {
                        ?>
                        <!-- data-toggle="modal" href="#myModalcomentario" -->
                       
                        <a   <?php if ($data_tareo['estado_tareopersona']=='C') { ?> disabled="disabled" <?php } else {?> id="coment<?php echo $i ?><?php echo $j?>"  hora="<?php echo $buscar_tarea[0]['h_real'] ?>" etapa="<?php echo $buscar_tarea[0]['etapa'] ?>" tipo-actividad="<?php echo $buscar_tarea[0]['tipo_actividad'] ?>" actividad-generalid="<?php echo $buscar_tarea[0]['actividad_generalid'] ?>" codigo-prop-proy="<?php echo $data_tareo['codigo_prop_proy'] ?>" proyectoid="<?php echo $data_tareo['proyectoid'] ?>" actividad-padre="<?php echo $buscar_tarea[0]['actividad_padre'] ?>" fecha-tarea="<?php echo $buscar_tarea[0]['fecha_tarea'] ?>" codigo-actividad="<?php echo $buscar_tarea[0]['codigo_actividad'] ?>" actividadid="<?php echo $buscar_tarea[0]['actividadid'] ?>" revision="<?php echo $buscar_tarea[0]['revision'] ?>" semanaid="<?php echo $buscar_tarea[0]['semanaid'] ?>" uid="<?php echo $data_tareo['uid'] ?>" dni="<?php echo $data_tareo['dni'] ?>" cargo="<?php echo $buscar_tarea[0]['cargo'] ?>" fecha-planificacion="<?php echo $buscar_tarea[0]['fecha_planificacion'] ?>"  <?php }?>
                        comentario="<?php echo $buscar_tarea[0]['comentario'] ?>" 

                       >
                       <i style="color: #D6D6D8" class="fa fa-comment"></i></a>                   

                      <?php }
                        else
                            {?>

                              <a   <?php if ($data_tareo['estado_tareopersona']=='C') { ?> disabled="disabled" <?php } else {?> id="coment<?php echo $i ?><?php echo $j?>"  hora="<?php echo $buscar_tarea[0]['h_real'] ?>" etapa="<?php echo $buscar_tarea[0]['etapa'] ?>" tipo-actividad="<?php echo $buscar_tarea[0]['tipo_actividad'] ?>" actividad-generalid="<?php echo $buscar_tarea[0]['actividad_generalid'] ?>" codigo-prop-proy="<?php echo $data_tareo['codigo_prop_proy'] ?>" proyectoid="<?php echo $data_tareo['proyectoid'] ?>" actividad-padre="<?php echo $buscar_tarea[0]['actividad_padre'] ?>" fecha-tarea="<?php echo $buscar_tarea[0]['fecha_tarea'] ?>" codigo-actividad="<?php echo $buscar_tarea[0]['codigo_actividad'] ?>" actividadid="<?php echo $buscar_tarea[0]['actividadid'] ?>" revision="<?php echo $buscar_tarea[0]['revision'] ?>" semanaid="<?php echo $buscar_tarea[0]['semanaid'] ?>" uid="<?php echo $data_tareo['uid'] ?>" dni="<?php echo $data_tareo['dni'] ?>" cargo="<?php echo $buscar_tarea[0]['cargo'] ?>" fecha-planificacion="<?php echo $buscar_tarea[0]['fecha_planificacion'] ?>"  <?php }?>
                        comentario="<?php echo $buscar_tarea[0]['comentario'] ?>" 

                       >
                       <i style="color: #485BBD" class="fa fa-comment"></i></a>                   

                      <?php
                            }
                          } 
                        }
                      ?>
                  </div>

                  
                  <input type="hidden" name="codigo_prop_proy[<?php echo $j ?>][<?php echo $i ?>]" value="<?php echo $data_tareo['codigo_prop_proy'] ?>"/>
                  <input type="hidden" name="codigo_actividad[<?php echo $j ?>][<?php echo $i ?>]" value="<?php echo $data_tareo['codigo_actividad'] ?>"/>
                  <input type="hidden" name="proyectoid[<?php echo $j ?>][<?php echo $i ?>]" value="<?php echo $data_tareo['proyectoid'] ?>"/>
                  <input type="hidden" name="actividadid[<?php echo $j ?>][<?php echo $i ?>]" value="<?php echo $data_tareo['actividadid'] ?>"/>
                  <input type="hidden" name="revision[<?php echo $j ?>][<?php echo $i ?>]" value="<?php echo $data_tareo['revision'] ?>"/>
                  <input type="hidden" name="actividad_padre[<?php echo $j ?>][<?php echo $i ?>]" value="<?php echo $data_tareo['actividad_padre'] ?>"/>
                  <input type="hidden" name="semanaid[<?php echo $j ?>][<?php echo $i ?>]" value="<?php echo $data_tareo['semanaid'] ?>"/>
                  <input type="hidden" name="fecha_tarea[<?php echo $j ?>][<?php echo $i ?>]" value="<?php echo $fecha_tarea ?>"/>  
                  <input type="hidden" name="asignado[<?php echo $j ?>][<?php echo $i ?>]" value="<?php echo $data_tareo['asignado'] ?>"/>                 
                  <input type="hidden" name="tipo_actividad[<?php echo $j ?>][<?php echo $i ?>]" value="<?php echo $data_tareo['tipo_actividad'] ?>"/>  
                  <input type="hidden" name="etapa[<?php echo $j ?>][<?php echo $i ?>]" value="<?php echo $data_tareo['etapa']?>"/> 
                  <input type="hidden" name="actividad_generalid[<?php echo $j ?>][<?php echo $i ?>]" value="<?php echo $data_tareo['actividad_generalid'] ?>"/>
                </center>

                <script type="text/javascript">
                  $(document).ready(function(){
                    $("#valor<?php echo $i ?><?php echo $j?>").focus();
                    $("#valor<?php echo $i ?><?php echo $j?>").keyup(function(e){                   
                      // alert('fff');
                        var hora_real=$(this).val(); 
                        var codigo_prop_proy="<?php echo $data_tareo['codigo_prop_proy'] ?>";
                        var codigo_actividad="<?php echo $data_tareo['codigo_actividad'] ?>";
                        var actividadid="<?php echo $data_tareo['actividadid'] ?>";
                        var revision="<?php echo $data_tareo['revision'] ?>";
                        var actividad_padre="<?php echo $data_tareo['actividad_padre'] ?>";
                        var proyectoid="<?php echo $data_tareo['proyectoid'] ?>";
                        var semanaid="<?php echo $data_tareo['semanaid'] ?>";
                        var fecha_tarea ="<?php echo $fecha ?>";
                        var asignado="<?php echo $data_tareo['asignado'] ?>";
                        var areaid="<?php echo $data_tareo['areaid'] ?>";
                        var categoriaid ="<?php echo $data_tareo['categoriaid'] ?>";
                        var dni="<?php echo $data_tareo['dni'] ?>";
                        var cargo="<?php echo $data_tareo['cargo'] ?>";
                        var tipo_actividad="<?php echo $data_tareo['tipo_actividad'] ?>";
                        var etapa="<?php echo $data_tareo['etapa'] ?>";                        
                        var actividad_generalid="<?php echo $data_tareo['actividad_generalid'] ?>";
                        var h_propuesta="<?php echo $data_tareo['h_propuesta'] ?>";
                        var fecha_calendario = $("#fechasemana").text();

                        var uid="<?php echo $this->uid ?>";
                        var dni_="<?php echo $this->dni ?>";
                        var fechainiciomod="<?php echo $this->fecha_inicio_mod ?>";
                        var fecha="<?php echo $this->fecha ?>";
                        var fechaz="<?php echo $data_tareo['fecha_tarea'] ?>";

                        /* codigo de lenon*/
                        
                        valor = parseFloat($(this).val()).toFixed(2);
                        if (isNaN(valor) || valor < 0 || valor > 24) {
                          $(this).val("");
                        };
                        max_horizontal = 50;
                        max_vertical = 50;
                        var matriz = new Array(max_horizontal);
                        for (i = 0; i < max_horizontal; i++)
                          matriz[i] = new Array(max_vertical);
                        $("[id*=valor]").each(function(indice, elemento) {
                          elemID = $(elemento).attr("id");
                          horizontal = elemID.slice(5,6);
                          vertical = elemID.slice(6,8);
                          matriz[horizontal][vertical] = $(elemento).val();
                        });
                        maximo = 0;
                        elemSuma = [];
                        for (var hor = 0; hor < max_horizontal; hor++) {
                          resSuma = 0;
                          for (var ver = 0; ver < max_vertical; ver++) {
                            if (typeof matriz[hor][ver] !== 'undefined') {
                              if (isNaN(parseFloat(matriz[hor][ver]))) {
                                matriz[hor][ver] = 0;
                              };
                              resSuma = resSuma + parseFloat(matriz[hor][ver]);
                              maximo = hor+1;};
                              
                            };
                            if (resSuma > 24) {
                              resSuma = resSuma - parseFloat($(this).val());
                              alert("La suma total no puede ser mayor a 24 horas");
                              $(this).val("");
                            };
                          elemSuma.push(resSuma);
                        };
                        mostrar = elemSuma.slice(0, maximo);
                        for (var i = 0; i < hor+1; i++) {
                          //alert(mostrar[i]);
                          $("#fecha_"+i).html(parseFloat(mostrar[i]).toFixed(2));
                        };

                        var hora_real=$("#valor<?php echo $i?><?php echo $j?>").val(); 

                        /* codigo de lenon ------*/

                        //if (isNaN(hora_real)) {
                           //entonces (no es numero) devuelvo el valor cadena vacia 
                           //alert('la hora no puede ser una letra');
                           //e.preventDefault();
                        //}else{ 
                           //En caso contrario (Si era un número) devuelvo el valor 
                         var url="/timesheet/index/updatetareoreal/codigo_prop_proy/"+codigo_prop_proy+"/codigo_actividad/"+codigo_actividad+"/actividadid/"+actividadid+"/revision/"+revision+"/actividad_padre/"+actividad_padre+"/proyectoid/"+proyectoid+"/semanaid/"+semanaid+"/fecha_tarea/"+fecha_tarea+"/asignado/"+asignado+"/areaid/"+areaid+"/categoriaid/"+categoriaid+"/dni/"+dni+"/cargo/"+cargo+"/horareal/"+hora_real+"/tipo_actividad/"+tipo_actividad+"/etapa/"+etapa+"/actividad_generalid/"+actividad_generalid+"/fecha_calendario/"+fecha_calendario+"/h_propuesta/"+h_propuesta;   

                          var url2='/timesheet/index/traersumahoras/semanaid/'+semanaid+'/fecha/'+fecha_tarea+'/fechainiciomod/'+fecha_tarea+'/uid/'+uid+'/dni/'+dni_+'/cargo/'+cargo;   
                          //alert(url);            

                           $.ajax({
                                    type: "POST",
                                    url: url,
                                    data: $(this).serialize(),
                                    dataType: "html",                                                 
                                    error: function(){
                                          alert("error petición ajax load");
                                    },
                                    success: function(data){                                                 
                                          //$("#carga").empty();
                                          $("#carga").html(data);                  
                                          $("#comentview").hide();                                          

                                              // $.ajax({
                                              //       type: "POST",
                                              //       url: url2,
                                              //       data: $(this).serialize(),
                                              //       dataType: "html",                                                 
                                              //       error: function(){
                                              //         alert("error petición ajax load");
                                              //       },
                                              //       success: function(data){                      
                                              //         $("#sumahoras<?php echo $i ?>").empty();
                                              //         $("#sumahoras<?php echo $i ?>").html(data);                                     
                                              //         $("#fecha_<?php echo $i?>").hide(); 
                                                       //var i="<?php echo $i ?>";
                                                       //var j="<?php echo $j ?>";                                                      
                                                       //sumar(j,i,hora_real);                
                                              //        }
                                              // });                                          
                                    }
                            });
                        //} 
                      });
                    });
                  
                </script> 
                </div>
              </td>

              <div class="modal fade" id="myModalcomentario" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-sm">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">Ingrese un Comentario</h4>
                    </div>
                    <div class="modal-body"> 
                      <div id="modaltimex"></div>                                  
                    </div>
                    <div class="modal-footer">
                      <button class="btn btn-danger" id="savecoment" type="button"> Guardar</button>
                      <button data-dismiss="modal" class="btn btn-default" type="button">Cerrar</button>                        
                    </div>
                  </div>
                </div>
              </div>


                    <script type="text/javascript">
                    $(document).ready(function(){
                          //$("#savecoment").click(function(){            
                          $("#coment<?php echo $i ?><?php echo $j?>").click(function(){            
                            //var coment=$("#message").val();
                            var hora = $("#coment<?php echo $i ?><?php echo $j?>").attr('hora');
                            var etapa = $("#coment<?php echo $i ?><?php echo $j?>").attr('etapa');
                            var tipo_actividad = $("#coment<?php echo $i ?><?php echo $j?>").attr('tipo-actividad');
                            var actividad_generalid = $("#coment<?php echo $i ?><?php echo $j?>").attr('actividad-generalid');
                            var codigo_prop_proy = $("#coment<?php echo $i ?><?php echo $j?>").attr('codigo-prop-proy');
                            var proyectoid = $("#coment<?php echo $i ?><?php echo $j?>").attr('proyectoid');
                            var actividad_padre = $("#coment<?php echo $i ?><?php echo $j?>").attr('actividad-padre');
                            var fecha_tarea = $("#coment<?php echo $i ?><?php echo $j?>").attr('fecha-tarea');
                            
                            var codigo_actividad = $("#coment<?php echo $i ?><?php echo $j?>").attr('codigo-actividad');
                            var actividadid = $("#coment<?php echo $i ?><?php echo $j?>").attr('actividadid');
                            var revision = $("#coment<?php echo $i ?><?php echo $j?>").attr('revision');
                            var semanaid = $("#coment<?php echo $i ?><?php echo $j?>").attr('semanaid');
                            var cargo = $("#coment<?php echo $i ?><?php echo $j?>").attr('cargo');
                            var fecha_planificacion = $("#coment<?php echo $i ?><?php echo $j?>").attr('fecha-planificacion');
                            var comentario = $("#coment<?php echo $i ?><?php echo $j?>").attr('comentario');
                            
                            var cc=comentario;
                            //alert(cc);
                            //alert(comentario);  
                            //alert(coment);
                            //alert(codigo_prop_proy);
                            // alert(codigo_actividad);
                            // alert(actividadid);
                            // alert(revision);
                            // alert(actividad_padre);
                            // alert(semanaid);
                            //alert(fecha_tarea);
                            // alert(cargo);
                            // alert(tipo_actividad);
                            // alert(etapa);
                            // alert(actividad_generalid);
                            // alert(hora);
                            // alert(proyectoid);                            
                            // alert(fecha_planificacion);
                            //alert("#coment<?php echo $i ?><?php echo $j?>");  

                            // var urlx="/timesheet/index/traercoment/codigo_prop_proy/"+codigo_prop_proy+"/codigo_actividad/"+codigo_actividad+"/actividadid/"+actividadid+"/revision/"+revision+"/actividad_padre/"+actividad_padre+"/proyectoid/"+proyectoid+"/semanaid/"+semanaid+"/fecha_tarea/"+fecha_tarea+"/cargo/"+cargo+"/horareal/"+hora+"/tipo_actividad/"+tipo_actividad+"/etapa/"+etapa+"/actividad_generalid/"+actividad_generalid+"/fecha_planificacion/"+fecha_planificacion+"/comentariox/"+cc;

                            //alert(urlx);

                            //$("#myModalcomentario").modal('show');
                            //$("#modaltimex").load(urlx);

                            alertify.prompt("Escriba un comentario", function (e, str) {
                            if (e) {
                            
                                var url="/timesheet/index/updatecoment/codigo_prop_proy/"+codigo_prop_proy+"/codigo_actividad/"+codigo_actividad+"/actividadid/"+actividadid+"/revision/"+revision+"/actividad_padre/"+actividad_padre+"/proyectoid/"+proyectoid+"/semanaid/"+semanaid+"/fecha_tarea/"+fecha_tarea+"/cargo/"+cargo+"/horareal/"+hora+"/tipo_actividad/"+tipo_actividad+"/etapa/"+etapa+"/actividad_generalid/"+actividad_generalid+"/fecha_planificacion/"+fecha_planificacion+"/comentario/"+str;

                                  $.ajax({
                                    type: "POST",
                                    url: url,
                                    data: $(this).serialize(),
                                    dataType: "html",                                                 
                                    error: function(){
                                      alert("error petición ajax load");
                                    },
                                    success: function(data){
                                
                                    }
                                  });

                                alertify.success("ha sido guardado su comentario: " + str);

                              } else {
                                alertify.error("ha sido Cancelado");
                              }
                            }, cc);
                             return false;                          


                            // $("#savecoment").click(function(){
                            //     var coment=$("#message").val();
                            // });
                    
                          });
                        });
                        </script>



                <?php 
                }
                  $newDate = date("Y-m-d", strtotime($fecha));
                  $nuevafecha = strtotime ( '+1 day' , strtotime ( $newDate ) ) ;
                  $fecha = date ( 'Y-m-d' , $nuevafecha );?>
                <?php }
                ?>


            </tr>

              <script type="text/javascript">
                $("#select_generalp_<?php echo $j?>").change(function(){
                  var tarea_general = $(this).val(); 
                  //alert(tarea_general);
                  //alert('1');
                   var codigo_prop_proy= '<?php echo $data_tareo['codigo_prop_proy']?>';
                    var codigo_actividad='<?php echo $data_tareo['codigo_actividad']?>';
                    var actividadid="<?php echo $data_tareo['actividadid']?>";
                    var revision="<?php echo $data_tareo['revision']?>";
                    var actividad_padre="<?php echo $data_tareo['actividad_padre'] ?>";
                    var proyectoid="<?php echo $data_tareo['proyectoid']?>";
                    var semanaid="<?php echo $data_tareo['semanaid']?>";
                    var fecha_tarea="<?php echo $data_tareo['fecha_tarea'] ?>";
                    var asignado="<?php echo $data_tareo['asignado']?>";
                    var areaid="<?php echo $data_tareo['areaid']?>";
                    var categoriaid="<?php echo $data_tareo['categoriaid']?>";
                    var dni="<?php echo $data_tareo['dni']?>";
                    var cargo="<?php echo $data_tareo['cargo']?>";
                    var etapa="<?php echo $data_tareo['etapa']?>";
                    var tipo_actividad="<?php echo $data_tareo['tipo_actividad']?>";
                    var fecha_planificacion="<?php echo $data_tareo['fecha_planificacion']?>";
                    var fecha = $("#fechasemana").text();

                    var url="/timesheet/index/updateetapanb/codigo/"+codigo_prop_proy+"/codigo_actividad/"+codigo_actividad+"/actividadid/"+actividadid+"/revision/"+revision+"/actividad_padre/"+actividad_padre+"/proyectoid/"+proyectoid+"/semanaid/"+semanaid+"/fecha_tarea/"+fecha_tarea+"/asignado/"+asignado+"/areaid/"+areaid+"/categoriaid/"+categoriaid+"/dni/"+dni+"/cargo/"+cargo+"/tipo_actividad/"+tipo_actividad+"/etapa/"+etapa+"/fecha_planificacion/"+fecha_planificacion+"/tarea_general/"+tarea_general+"/fecha/"+fecha;


                    //alert(url);
                    //$("#carga").load(url);
                    var dateObj = new Date();
                    var dateFrom = $.datepicker.formatDate('mm/dd/yy', dateObj);
                    var weekfrom = $.datepicker.iso8601Week(new Date(dateFrom));
                    var diasSemana = new Array("Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado");
                    var day_select = diasSemana[dateObj.getDay()];
                    for (i = 0; i < diasSemana.length; i++) { 
                      if (diasSemana[i] == day_select) {
                        if (i == 0) {
                          var num_day = 6;
                        } else {
                          var num_day = i - 1;
                        };
                      };
                    };
                    fecha_inicio = mostrarFecha(dateObj,-num_day);
                    urlfecha="/timesheet/index/registro/fecha/" + fecha_inicio;
                    //$("#registros").load("/timesheet/index/registro/fecha/" + fecha_inicio); 
                       //document.location.href="/timesheet/index/calendar";
                    $.ajax({
                        type: "POST",
                        url: url,
                        data: $(this).serialize(),
                        dataType: "html",                                                 
                        error: function(){
                              alert("error petición ajax load");
                        },
                        success: function(data){      
                                $("#carga").html(data);
                                $.ajax({
                                    type: "POST",
                                    url: urlfecha,
                                    data: $(this).serialize(),
                                    dataType: "html",                                                 
                                    error: function(){
                                          alert("error petición ajax load");
                                    },
                                    success: function(data){      
                                            $("#registro").html(data);     
                                    }  
                                });  
                        }
                    });    
                    //$("#carga").load(url);

                });

                $("#select_generalg_<?php echo $j?>").change(function(){
                  var tarea_general = $(this).val(); 
                  //alert(tarea_general);
                 //alert("2");
                    var actividad_generalid="<?php echo $data_tareo['actividad_generalid']?>";
                    //alert(actividad_generalid);
                  var codigo_prop_proy= '<?php echo $data_tareo['codigo_prop_proy']?>';
                    var codigo_actividad='<?php echo $data_tareo['codigo_actividad']?>';
                    var actividadid="<?php echo $data_tareo['actividadid']?>";
                    var revision="<?php echo $data_tareo['revision']?>";
                    var actividad_padre="<?php echo $data_tareo['actividad_padre'] ?>";
                    var proyectoid="<?php echo $data_tareo['proyectoid']?>";
                    var semanaid="<?php echo $data_tareo['semanaid']?>";
                    var fecha_tarea="<?php echo $data_tareo['fecha_tarea'] ?>";
                    var asignado="<?php echo $data_tareo['asignado']?>";
                    var areaid="<?php echo $data_tareo['areaid']?>";
                    var categoriaid="<?php echo $data_tareo['categoriaid']?>";
                    var dni="<?php echo $data_tareo['dni']?>";
                    var cargo="<?php echo $data_tareo['cargo']?>";
                    var etapa="<?php echo $data_tareo['etapa']?>";
                    var tipo_actividad="<?php echo $data_tareo['tipo_actividad']?>";
                    var fecha_planificacion="<?php echo $data_tareo['fecha_planificacion']?>";
                    var fecha = $("#fechasemana").text();

                    var url="/timesheet/index/updateetapanb/codigo/"+codigo_prop_proy+"/codigo_actividad/"+codigo_actividad+"/actividadid/"+actividadid+"/revision/"+revision+"/actividad_padre/"+actividad_padre+"/proyectoid/"+proyectoid+"/semanaid/"+semanaid+"/fecha_tarea/"+fecha_tarea+"/asignado/"+asignado+"/areaid/"+areaid+"/categoriaid/"+categoriaid+"/dni/"+dni+"/cargo/"+cargo+"/tipo_actividad/"+tipo_actividad+"/etapa/"+etapa+"/fecha_planificacion/"+fecha_planificacion+"/tarea_general/"+tarea_general+"/fecha/"+fecha+"/actividad_generalid/"+actividad_generalid+"/ban/0";


                    //alert(url);
                   
                    if (isNaN(tarea_general)) {
                           //entonces (no es numero) devuelvo el valor cadena vacia 
                           alert('la actividad esta duplicada, cargue nuevamente la pagina');
                           //e.preventDefault();
                    }else{ 

                    var dateObj = new Date();
                    var dateFrom = $.datepicker.formatDate('mm/dd/yy', dateObj);
                    var weekfrom = $.datepicker.iso8601Week(new Date(dateFrom));
                    var diasSemana = new Array("Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado");
                    var day_select = diasSemana[dateObj.getDay()];
                    for (i = 0; i < diasSemana.length; i++) { 
                      if (diasSemana[i] == day_select) {
                        if (i == 0) {
                          var num_day = 6;
                        } else {
                          var num_day = i - 1;
                        };
                      };
                    };
                    fecha_inicio = mostrarFecha(dateObj,-num_day);
                    urlfecha="/timesheet/index/registro/fecha/" + fecha_inicio;
                  //  $("#registros").load("/timesheet/index/registro/fecha/" + fecha_inicio); 
                    //document.location.href="/timesheet/index/calendar";
                    $.ajax({
                        type: "POST",
                        url: url,
                        data: $(this).serialize(),
                        dataType: "html",                                                 
                        error: function(){
                              alert("error petición ajax load");
                        },
                        success: function(data){      
                                $("#carga").html(data);
                                $.ajax({
                                    type: "POST",
                                    url: urlfecha,
                                    data: $(this).serialize(),
                                    dataType: "html",                                                 
                                    error: function(){
                                          alert("error petición ajax load");
                                    },
                                    success: function(data){      
                                            $("#registro").html(data);     
                                    }
                                });     
                        }
                    });    
                    //$("#carga").load(url);
                    //$("#registro").load();
                  }
                }); 
                

                $(document).ready(function(){
                  $("#nofacturable_cambio_<?php echo $j?>").click(function(){
                    //alert("ssss");
                    //$("#tarea_general_<?php echo $j?>").show();
                    //$("#facturable_tareo_<?php echo $j?>").hide();
                    //$("#nofacturable_tareo_<?php echo $j?>").show();
                    //$("#tarea_proyecto_<?php echo $j?>").hide();                   
                    var codigo_prop_proy= "<?php echo $data_tareo['codigo_prop_proy']?>";
                    var codigo_actividad="<?php echo $data_tareo['codigo_actividad']?>";
                    var actividadid="<?php echo $data_tareo['actividadid']?>";
                    var revision="<?php echo $data_tareo['revision']?>";
                    var actividad_padre="<?php echo $data_tareo['actividad_padre'] ?>";
                    var proyectoid="<?php echo $data_tareo['proyectoid']?>";
                    var semanaid="<?php echo $data_tareo['semanaid']?>";
                    var fecha_tarea="<?php echo $data_tareo['fecha_tarea'] ?>";
                    var asignado="<?php echo $data_tareo['asignado']?>";
                    var areaid="<?php echo $data_tareo['areaid']?>";
                    var categoriaid="<?php echo $data_tareo['categoriaid']?>";
                    var dni="<?php echo $data_tareo['dni']?>";
                    var cargo="<?php echo $data_tareo['cargo']?>";
                    var etapa="<?php echo $data_tareo['etapa']?>";
                    var tipo_actividad="<?php echo $data_tareo['tipo_actividad']?>";
                    var fecha_planificacion="<?php echo $data_tareo['fecha_planificacion']?>";
                    var fecha = $("#fechasemana").text();

                    var url="/timesheet/index/updateetapab/codigo/"+codigo_prop_proy+"/codigo_actividad/"+codigo_actividad+"/actividadid/"+actividadid+"/revision/"+revision+"/actividad_padre/"+actividad_padre+"/proyectoid/"+proyectoid+"/semanaid/"+semanaid+"/fecha_tarea/"+fecha_tarea+"/asignado/"+asignado+"/areaid/"+areaid+"/categoriaid/"+categoriaid+"/dni/"+dni+"/cargo/"+cargo+"/tipo_actividad/"+tipo_actividad+"/etapa/"+etapa+"/fecha_planificacion/"+fecha_planificacion+"/fecha/"+fecha;
                    // alert(url);
                   
                    var dateObj = new Date();
                    var dateFrom = $.datepicker.formatDate('mm/dd/yy', dateObj);
                    var weekfrom = $.datepicker.iso8601Week(new Date(dateFrom));
                    var diasSemana = new Array("Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado");
                    var day_select = diasSemana[dateObj.getDay()];
                    for (i = 0; i < diasSemana.length; i++) { 
                      if (diasSemana[i] == day_select) {
                        if (i == 0) {
                          var num_day = 6;
                        } else {
                          var num_day = i - 1;
                        };
                      };
                    };
                    fecha_inicio = mostrarFecha(dateObj,-num_day);
                    urlfecha="/timesheet/index/registro/fecha/" + fecha_inicio;

                    $.ajax({
                        type: "POST",
                        url: url,
                        data: $(this).serialize(),
                        dataType: "html",                                                 
                        error: function(){
                              alert("error petición ajax load");
                        },
                        success: function(data){      
                                $("#carga").html(data);  
                                $.ajax({
                                    type: "POST",
                                    url: urlfecha,
                                    data: $(this).serialize(),
                                    dataType: "html",                                                 
                                    error: function(){
                                          alert("error petición ajax load");
                                    },
                                    success: function(data){      
                                            $("#registro").html(data);     
                                    }
                                });     
                        }
                    });                    
                    //$("#carga").load(url);
                    //$("#registro").load(); 
                  });
                });


                $(document).ready(function(){
                  $("#facturable_tareo_<?php echo $j?>").click(function(){

                    var actividad_generalid="<?php echo $data_tareo['actividad_generalid']?>";

                    var codigo_prop_proy= "<?php echo $data_tareo['codigo_prop_proy']?>";
                    var codigo_actividad="<?php echo $data_tareo['codigo_actividad']?>";
                    var actividadid="<?php echo $data_tareo['actividadid']?>";
                    var revision="<?php echo $data_tareo['revision']?>";
                    var actividad_padre="<?php echo $data_tareo['actividad_padre'] ?>";
                    var proyectoid="<?php echo $data_tareo['proyectoid']?>";
                    var semanaid="<?php echo $data_tareo['semanaid']?>";
                    var fecha_tarea="<?php echo $data_tareo['fecha_tarea'] ?>";
                    var asignado="<?php echo $data_tareo['asignado']?>";
                    var areaid="<?php echo $data_tareo['areaid']?>";
                    var categoriaid="<?php echo $data_tareo['categoriaid']?>";
                    var dni="<?php echo $data_tareo['dni']?>";
                    var cargo="<?php echo $data_tareo['cargo']?>";
                    var etapa="<?php echo $data_tareo['etapa']?>";
                    var tipo_actividad="<?php echo $data_tareo['tipo_actividad']?>";
                    var fecha_planificacion="<?php echo $data_tareo['fecha_planificacion']?>";
                    var fecha = $("#fechasemana").text();

                    var url="/timesheet/index/updateetapanb/codigo/"+codigo_prop_proy+"/codigo_actividad/"+codigo_actividad+"/actividadid/"+actividadid+"/revision/"+revision+"/actividad_padre/"+actividad_padre+"/proyectoid/"+proyectoid+"/semanaid/"+semanaid+"/fecha_tarea/"+fecha_tarea+"/asignado/"+asignado+"/areaid/"+areaid+"/categoriaid/"+categoriaid+"/dni/"+dni+"/cargo/"+cargo+"/tipo_actividad/"+tipo_actividad+"/etapa/"+etapa+"/fecha_planificacion/"+fecha_planificacion+"/fecha/"+fecha+"/actividad_generalid/"+actividad_generalid+"/ban/1";



                    //alert(url);

                    var dateObj = new Date();
                    var dateFrom = $.datepicker.formatDate('mm/dd/yy', dateObj);
                    var weekfrom = $.datepicker.iso8601Week(new Date(dateFrom));
                    var diasSemana = new Array("Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado");
                    var day_select = diasSemana[dateObj.getDay()];
                    for (i = 0; i < diasSemana.length; i++) { 
                      if (diasSemana[i] == day_select) {
                        if (i == 0) {
                          var num_day = 6;
                        } else {
                          var num_day = i - 1;
                        };
                      };
                    };
                    fecha_inicio = mostrarFecha(dateObj,-num_day);
                    urlfecha="/timesheet/index/registro/fecha/" + fecha;
             

                    $.ajax({
                        type: "POST",
                        url: url,
                        data: $(this).serialize(),
                        dataType: "html",                                                 
                        error: function(){
                              alert("error petición ajax load");
                        },
                        success: function(data){      
                              $("#carga").html(data);
                              $.ajax({
                                  type: "POST",
                                  url: urlfecha,
                                  data: $(this).serialize(),
                                  dataType: "html",                                                 
                                  error: function(){
                                        alert("error petición ajax load");
                                  },
                                  success: function(data){      
                                          $("#registro").html(data);
                                          $("#facturable_tareo_<?php echo $j?>").hide();
                                          $("#tarea_general_<?php echo $j?>").show();
                                          $("#nofacturable_tareo_<?php echo $j?>").show();
                                        
                                  }
                              }); 
                          
                        }
                    });                                        
                   
                  });
                });

                $(document).ready(function(){
                  $("#nofacturable_tareo_<?php echo $j?>").click(function(){

                    $("#facturable_tareo_<?php echo $j?>").show();
                    $("#tarea_general_<?php echo $j?>").hide();
                    $("#nofacturable_tareo_<?php echo $j?>").hide(); 


                  });
                });

                $(document).ready(function(){
                  $("#crear_tareag_<?php echo $j?>").click(function(){

                    //alert('sssszzzz');
                    var codigo_prop_proy= '<?php echo $data_tareo['codigo_prop_proy']?>';
                    var codigo_actividad='<?php echo $data_tareo['codigo_actividad']?>';
                    var actividadid="<?php echo $data_tareo['actividadid']?>";
                    var revision="<?php echo $data_tareo['revision']?>";
                    var actividad_padre="<?php echo $data_tareo['actividad_padre'] ?>";
                    var proyectoid="<?php echo $data_tareo['proyectoid']?>";
                    var semanaid="<?php echo $data_tareo['semanaid']?>";
                    var fecha_tarea="<?php echo $data_tareo['fecha_tarea'] ?>";
                    var asignado="<?php echo $data_tareo['asignado']?>";
                    var areaid="<?php echo $data_tareo['areaid']?>";
                    var categoriaid="<?php echo $data_tareo['categoriaid']?>";
                    var dni="<?php echo $data_tareo['dni']?>";
                    var cargo="<?php echo $data_tareo['cargo']?>";
                    var etapa="<?php echo $data_tareo['etapa']?>";
                    var tipo_actividad="<?php echo $data_tareo['tipo_actividad']?>";
                    var fecha_planificacion="<?php echo $data_tareo['fecha_planificacion']?>";
                     var fecha = $("#fechasemana").text();


                    var url="/timesheet/index/guardaractividadgeneral/codigo/"+codigo_prop_proy+"/codigo_actividad/"+codigo_actividad+"/actividadid/"+actividadid+"/revision/"+revision+"/actividad_padre/"+actividad_padre+"/proyectoid/"+proyectoid+"/semanaid/"+semanaid+"/fecha_tarea/"+fecha_tarea+"/asignado/"+asignado+"/areaid/"+areaid+"/categoriaid/"+categoriaid+"/dni/"+dni+"/cargo/"+cargo+"/tipo_actividad/"+tipo_actividad+"/etapa/"+etapa+"/fecha_planificacion/"+fecha_planificacion+"/fecha/"+fecha;
                    
                    //alert(url);
                    var dateObj = $('#datepicker').datepicker('getDate');
                    var dateFrom = $.datepicker.formatDate('mm/dd/yy', dateObj);
                    var weekfrom = $.datepicker.iso8601Week(new Date(dateFrom));
                    var diasSemana = new Array("Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado");
                    var day_select = diasSemana[dateObj.getDay()];
                    for (i = 0; i < diasSemana.length; i++) { 
                      if (diasSemana[i] == day_select) {
                        if (i == 0) {
                          var num_day = 6;
                        } else {
                          var num_day = i - 1;
                        };
                      };
                    };

                    fecha_inicio = mostrarFecha(dateObj,-num_day);
                    urlfecha="/timesheet/index/registro/fecha/" + fecha_inicio;
                     
                     //$("#carga_nueva").load(url);
                      $.ajax({
                        type: "POST",
                        url: url,
                        data: $(this).serialize(),
                        dataType: "html",                                                 
                        error: function(){
                              alert("error petición ajax load");
                        },
                        success: function(data){      
                                $("#carga_nueva").html(data);
                                $.ajax({
                                  type: "POST",
                                  url: urlfecha,
                                  data: $(this).serialize(),
                                  dataType: "html",                                                 
                                  error: function(){
                                        alert("error petición ajax load");
                                  },
                                  success: function(data){      
                                          $("#registro").html(data);     
                                  }
                                });       
                        }
                      });
                    //alert(urlfecha);
                    //$("#registro").load(urlfecha);
                  });
                });
            

                $(document).ready(function(){
                  $("#eliminar_tareo_<?php echo $j?>").click(function(){
                    //$("#tr_tareo_<?php echo $j?>").hide();
                    var codigo_prop_proy= '<?php echo $data_tareo['codigo_prop_proy']?>';
                    var codigo_actividad='<?php echo $data_tareo['codigo_actividad']?>';
                    var actividadid="<?php echo $data_tareo['actividadid']?>";
                    var revision="<?php echo $data_tareo['revision']?>";
                    var actividad_padre="<?php echo $data_tareo['actividad_padre'] ?>";
                    var proyectoid="<?php echo $data_tareo['proyectoid']?>";
                    var semanaid="<?php echo $data_tareo['semanaid']?>";
                    var fecha_tarea="<?php echo $data_tareo['fecha_tarea'] ?>";
                    var asignado="<?php echo $data_tareo['asignado']?>";
                    var areaid="<?php echo $data_tareo['areaid']?>";
                    var categoriaid="<?php echo $data_tareo['categoriaid']?>";
                    var dni="<?php echo $data_tareo['dni']?>";
                    var cargo="<?php echo $data_tareo['cargo']?>";
                    var etapa="<?php echo $data_tareo['etapa']?>";
                    var tipo_actividad="<?php echo $data_tareo['tipo_actividad']?>";
                    var fecha_planificacion="<?php echo $data_tareo['fecha_planificacion']?>";
                    var actividad_generalid="<?php echo $data_tareo['actividad_generalid']?>";
                    var fecha_calendario = $("#fechasemana").text();
                    
                    var url="/timesheet/index/eliminartareo/codigo/"+codigo_prop_proy+"/codigo_actividad/"+codigo_actividad+"/actividadid/"+actividadid+"/revision/"+revision+"/actividad_padre/"+actividad_padre+"/proyectoid/"+proyectoid+"/semanaid/"+semanaid+"/fecha_tarea/"+fecha_tarea+"/asignado/"+asignado+"/areaid/"+areaid+"/categoriaid/"+categoriaid+"/dni/"+dni+"/cargo/"+cargo+"/tipo_actividad/"+tipo_actividad+"/etapa/"+etapa+"/fecha_planificacion/"+fecha_planificacion+"/actividad_generalid/"+actividad_generalid;

                    //alert(url);

                    var dateObj = $('#datepicker').datepicker('getDate');
                    var dateFrom = $.datepicker.formatDate('mm/dd/yy', dateObj);
                    var weekfrom = $.datepicker.iso8601Week(new Date(dateFrom));
                    var diasSemana = new Array("Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado");
                    var day_select = diasSemana[dateObj.getDay()];
                      for (i = 0; i < diasSemana.length; i++) 
                      { 
                        if (diasSemana[i] == day_select) {
                            if (i == 0) {
                                  var num_day = 6;
                            } else {
                                  var num_day = i - 1;
                            };
                        };
                      };

                    fecha_inicio = mostrarFecha(dateObj,-num_day);
                    //document.location.href="/timesheet/index/calendar";
                    urlfecha="/timesheet/index/registro/fecha/" + fecha_inicio;
                            

                    var r = confirm("Desea Eliminar esta tarea!");
                    if (r == true)
                    {
                     // $("#tr_tareo_<?php echo $j?>").hide();
                    //alert(url);
                    //e.preventDefault;
                            $.ajax({
                                type: "POST",
                                url: url,
                                data: $(this).serialize(),
                                dataType: "html",
                                success: function(data){      
                                    $("#carga_nueva").html(data);
                                    $.ajax({
                                        type: "POST",
                                        url: urlfecha,
                                        data: $(this).serialize(),
                                        dataType: "html",
                                        success: function(data){      
                                            $("#registro").html(data);     
                                        }
                                    });     
                                }
                            });
                    //$("#carga_nueva").load(url);
                    //$("#registro").load();
                    }
                  });
                });
              </script>

            <?php $j++;
             //}
            }?>
           </tbody>
           <tfoot class="fixedFooter">
          
           <?php if ( $this->actividades) {?>
          <tr >
            <th style="width: 5%;"></th>
            <th style="width: 60%;" ></th>
            <th style="width: 10%; padding: 0;"><div class="div-celda" style="width: 100px;"></div></th>
            <th style="width: 10%; padding: 0;"><div class="div-celda" style="width: 100px;"></div></th>
            <?php 
              $uid=$this->uid;
                // echo $uid;echo "<br>";
              $dni=$this->dni;
              $fecha = $this->fecha;
              $fecha = date("Y-m-d", strtotime($fecha));
              for ($i=0; $i < 7; $i++) { ?>
              <th style="width: 60px; padding:0;">
                <center class="div-celda">
                    <div id="fecha_<?php echo $i?>" maxlength="4">
                    <?php  $tareopersona = new Admin_Model_DbTable_Tareopersona();
                    $sumar=$tareopersona-> _getHorasRealxDia($data_tareo['semanaid'],$fecha,$uid,$dni);
                    print_r($sumar[0]['tareo_persona_horas_reales']); 
                    ?>
                    </div>
                  <!-- <div id="fecha_<?php //echo $i?>"> -->
                  <?php                
                  // $wheres=array('dni'=>$dni,'uid'=>$uid,'cargo'=>$data_tareo['cargo'],'semanaid'=>$data_tareo['semanaid'],'fecha_tarea'=>$fecha);
                  // $sumhora=  new  Admin_Model_DbTable_Sumahora();
                  // $sh=$sumhora->_getOne($wheres);
                  // print_r($sh['h_totaldia']);
                  ?>
                  <!-- </div> -->
                </center>
                <center><div id="sumahoras<?php echo $i ?>"></div></center>

              </th>
                <?php
                  $newDate = date("Y-m-d", strtotime($fecha));
                  $nuevafecha = strtotime ( '+1 day' , strtotime ( $newDate ) ) ;
                  $fecha = date ( 'Y-m-d' , $nuevafecha );
                }

              ?>
          </tr>
          <?php }?>

          </tfoot> 
          </table>
        
        </div>
      </div>
    </section>
  </div>
</form>
</div>

<script src="/js/alertify.min.js"></script>
 <link rel="stylesheet" href="/css/alertify.core.css" />
<link rel="stylesheet" href="/css/alertify.default.css" id="toggleCSS" />
<link rel="stylesheet" href="/css/alertify.bootstrapx.css" id="toggleCSS" />
<!--
<link rel="stylesheet" href="/css/alertify1.4.1/alertify.css" id="toggleCSS" /> 
<link rel="stylesheet" href="/css/alertify1.4.1/alertify.min.css" id="toggleCSS" /> 
<link rel="stylesheet" href="/css/alertify1.4.1/alertify.rtl.css" id="toggleCSS" /> 
<link rel="stylesheet" href="/css/alertify1.4.1/alertify.rtl.min.css" id="toggleCSS" />  -->
<!-- <body ng-app="angularSuma" ng-controller="sumaController as vm">
  <h1>Suma de numeros:</h1>
  <div ng-repeat="elemento in vm.elementos track by $index">
     <input type="text"  ng-model="vm.elementos[$index]" ng-change="vm.sumar()">
  </div>
  <input type="button" value="Agregar" ng-click="vm.agregar()">
  {{vm.resultado}}
</body> -->
<!--   <input type="text" id="num1">
  <input type="text" id="num2">
  <input type="text" id="num3">
  <input type="text" id="num4">
 -->
<!-- <div class="row">
<form action="" id="form_rendicion" class="form-horizontal">
<?php 
  for ($i=0; $i < 6; $i++) { 
  ?>
  <input type="text" name="gasto_persona_id[]" value="989"/>
  <?php 
  }  
?>
<form>
</div> -->

<script type="text/javascript">

     $('#save_hours').click(function(){
        var dateObj = $('#datepicker').datepicker('getDate');
        alert("Guardando Registros al Sistema. Gracias");
        var dateFrom = $.datepicker.formatDate('mm/dd/yy', dateObj);
        var weekfrom = $.datepicker.iso8601Week(new Date(dateFrom));
        var diasSemana = new Array("Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado");
        var day_select = diasSemana[dateObj.getDay()];
        
        for (i = 0; i < diasSemana.length; i++) { 
            if (diasSemana[i] == day_select) {
                if (i == 0) {
                    var num_day = 6;
                    
                } else {
                    var num_day = i - 1;
                };
            };
        };
        fecha_inicio = mostrarFecha(dateObj,-num_day);
        $.ajax({
            type   : 'post',
            url    : '/timesheet/index/prueba/',
            data   : $('#form_time').serialize(),
            success: function(data){
              $("#registro").load("/timesheet/index/registro/fecha/" + fecha_inicio);
            }
        });
        
    });
</script>
 


<div class="col-lg-10 "  style="padding-top: 10px;padding-bottom: 10px;padding-right: 10px;padding-left: 10px;">
<?php 
  $sumahorassemana = new Admin_Model_DbTable_Sumahorasemana();
  $wheres=array('dni'=>$this->dni,'uid'=>$this->uid,'semanaid'=>$this->semana);
  $tareosemana=$sumahorassemana->_getOne($wheres);
  $estado_horas=$tareosemana['estado'];
  $uid=$this->uid;
  $dni=$this->dni;
  $semanaid=$this->semana;
  $vercoment= new Admin_Model_DbTable_Usuariovalidacion();
  if($vcoment=$vercoment->_getUsuarioxValidacion($semanaid,$uid,$dni))

   // print_r($vcoment);
  {?>
  <table class="table alert-info">
    <tr>
      <th style="width: 20%;">  Usuario</th>
      <th style="width: 15%;" > Estado</th>
      <th style="width: 15%;"> Fecha</th>
      <th style="width: 40%;"> Comentario</th>
    </tr>
    <?php
    foreach ($vcoment as $historico) {
      //print_r($historico);?>
    <tr>
      <td>
        <?php print_r($historico['uid_validacion'])?>  
      </td>
      <td>
        <?php 
          if ($historico['etapa']=='0'){
            echo "Enviado Aprobacion";}
          if ($historico['etapa']=='1' and $historico['estado_usuario']=='B'){
            echo "Aprobado por el Jefe Area";}  
          if ($historico['etapa']=='1' and $historico['estado_usuario']=='R'){
            echo "Rechazado por el Jefe Area";}  
            if ($historico['etapa']=='2' and $historico['estado_usuario']=='R'){
            echo "Rechazado por el Gerente Proyecto";}  
                if ($historico['etapa']=='2' and $historico['estado_usuario']=='B'){
            echo "Aprobado por el Gerente Proyecto";}  
        //print_r($historico['estado_usuario'])?>  
      </td>
      <td>
        <?php print_r($historico['fecha_validacion'])?>  
      </td>
      <td>
        <?php print_r($historico['comentario'])?>  
      </td>
    </tr>
    <?php
    }
  }
?>
</table>
</div>

<div style="display:none" id="horaregistrada"></div>
<div style="display:none" id="carga"></div>
<div style="display:none"  id="carga_nueva"></div>
<div style="display:none"  id="carga_copiar"></div>
<div style="display:none" id="carga_w1"></div>



  <table  class="display table table-bordered table-striped" id="dynamic-table">
      <thead>
          <tr>
            <th style="width: 10%;">Fecha  </th>
            <th style="width: 30%;" >Proyecto </th> 
            <th style="width: 20%;" > Actividad: Tarea</th> 
            <th style="width: 5%;" > hora</th> 
            <th style="width: 35%;" > Comentario</th> 
          </tr>
         
            
      </thead>
      <tbody>
             
          <?php           
            $uid=$this->uid;            
            $dni=$this->dni;
            $semana=$this->semana;
    
            $tareopersona = new Admin_Model_DbTable_Tareopersona();
            $wheres=array('dni'=>$dni,'uid'=>$uid,'semanaid'=>$semana);                
            $tpercoment=$tareopersona->_getFilter($wheres);
            if ($tpercoment) {
              foreach ($tpercoment as $value) {              
                if(trim($value['comentario'])!='' and trim($value['h_real'])!=''){
                ?>
                <tr>
                 
                  <th>
                     <?php echo $value['fecha_tarea']; ?>
                  </th>
                  <th>
                    <?php 
                     //codigo_prop_proy, proyectoid
                     $wherep=array('codigo_prop_proy'=>$value['codigo_prop_proy'],'proyectoid'=>$value['proyectoid']); 
                     $nompro=new Admin_Model_DbTable_Proyecto();
                     $npro=$nompro->_getOne($wherep);
                     echo $value['proyectoid'];
                     echo " ";
                     echo $npro['nombre_proyecto'];
                    ?>
                  </th>
                  <th>
                     <?php //echo $value['actividadid'];
                     //codigo_prop_proy, codigo_actividad, actividadid, revision
                      $wherea=array('codigo_prop_proy'=>$value['codigo_prop_proy'],'codigo_actividad'=>$value['codigo_actividad'],'actividadid'=>$value['actividadid'],'revision'=>$value['revision']);                

                      $nomact = new Admin_Model_DbTable_Actividad();
                      $noma=$nomact->_getOne($wherea);
                      echo $noma['nombre'];

                     ?>
                  </th>
                  <th>
                     <?php echo $value['h_real']; ?>
                  </th>               
                  <th>                    
                      <?php echo $value['comentario']; ?>                                             
                  </th>             
                
                </tr>
                <?php  
                }              
              }
            }
              // $newDate = date("Y-m-d", strtotime($fecha));
              // $nuevafecha = strtotime ('+1 day' , strtotime ( $newDate ) ) ;
              // $fecha = date ('d-m-Y', $nuevafecha );
            
            // }

            ?>
      </tbody>

  </table>


<script type="text/javascript">
function fnc(evt) {
    var evt = evt.target ? evt : window.event;
    if (!evt.target) { evt.target = evt.srcElement; }
    var hora = $("#horaregistrada").text();
    values="-";
    $("#horaregistrada").text( values ); 
    var variables_input=evt.target.id;
    //alert(variables_input);
    var hora_real = parseInt(hora);
    var array_variables = variables_input.split("!");  
    var codigo_prop_proy=array_variables[0];
    var codigo_actividad=array_variables[1];
    var actividadid=array_variables[2];
    var revision=array_variables[3];
    var actividad_padre=array_variables[4];
    var proyectoid=array_variables[5];
    var semanaid=array_variables[6];
    var fecha_tarea =array_variables[7];
    var asignado=array_variables[8];
    var areaid=array_variables[9];
    var categoriaid =array_variables[10];
    var dni=array_variables[11];
    var cargo=array_variables[12];
    var tipo_actividad=array_variables[13];
    var etapa=array_variables[14];
    var fecha_imprimir=array_variables[15];
    var actividad_generalid=array_variables[16];
    
    if (isNaN(hora_real)) {
    var hora_real='0';
    }
    //else{
    //var horasumanew=parseInt(horasuma);
    //}
    if (isNaN(hora_real)) {
    }
    else
    {
      var url="/timesheet/index/updatetareoreal/codigo_prop_proy/"+codigo_prop_proy+"/codigo_actividad/"+codigo_actividad+"/actividadid/"+actividadid+"/revision/"+revision+"/actividad_padre/"+actividad_padre+"/proyectoid/"+proyectoid+"/semanaid/"+semanaid+"/fecha_tarea/"+fecha_tarea+"/asignado/"+asignado+"/areaid/"+areaid+"/categoriaid/"+categoriaid+"/dni/"+dni+"/cargo/"+cargo+"/horareal/"+hora_real+"/tipo_actividad/"+tipo_actividad+"/etapa/"+etapa+"/actividad_generalid/"+actividad_generalid;
      //alert(url);
      //$("#carga").load(url);
    
     var dateObj = new Date();
                    var dateFrom = $.datepicker.formatDate('mm/dd/yy', dateObj);
                    var weekfrom = $.datepicker.iso8601Week(new Date(dateFrom));
                    var diasSemana = new Array("Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado");
                    var day_select = diasSemana[dateObj.getDay()];
                    for (i = 0; i < diasSemana.length; i++) { 
                      if (diasSemana[i] == day_select) {
                        if (i == 0) {
                          var num_day = 6;
                        } else {
                          var num_day = i - 1;
                        };
                      };
                    };
                    fecha_inicio = mostrarFecha(dateObj,-num_day);
                    //document.location.href="/timesheet/index/calendar";
    }

}

$( "input" )
.keyup(function() {
    valor = parseFloat($(this).val()).toFixed(2);
    if (isNaN(valor) || valor < 0 || valor > 24) {
      $(this).val("");
    };
    max_horizontal = 50;
    max_vertical = 50;
    var matriz = new Array(max_horizontal);
    for (i = 0; i < max_horizontal; i++)
        matriz[i] = new Array(max_vertical);
        $("[id*=valor]").each(function(indice, elemento) {
        elemID = $(elemento).attr("id");
        horizontal = elemID.slice(5,6);
        vertical = elemID.slice(6,8);
        matriz[horizontal][vertical] = $(elemento).val();
        });
    maximo = 0;
    elemSuma = [];
    for (var hor = 0; hor < max_horizontal; hor++) {
      resSuma = 0;
      for (var ver = 0; ver < max_vertical; ver++) {
        if (typeof matriz[hor][ver] !== 'undefined') {
          if (isNaN(parseFloat(matriz[hor][ver])))
          {
            matriz[hor][ver] = 0;
          };
          resSuma = resSuma + parseFloat(matriz[hor][ver]);
          maximo = hor+1;};
         
        };
        if (resSuma > 24) {
          resSuma = resSuma - parseFloat($(this).val());
          alert("La suma total no puede ser mayor a 24 horas");
          $(this).val("");
        };
          elemSuma.push(resSuma);
      };
      mostrar = elemSuma.slice(0, maximo);
      for (var i = 0; i < hor+1; i++) {
          //alert(mostrar[i]);
      $("#fecha_"+i).html(parseFloat(mostrar[i]).toFixed(2));
      };

});


/*Funcion para utilizar las flechas direccionales en los campos del timesheet*/    
$("input.focusable").keydown(function(tecla){
  if (tecla.which == 39) {
    horizontal = $(this).attr('id').slice(5,6);
    siguiente = parseInt(horizontal) + 1;
    sig = '#valor' + siguiente + $(this).attr('id').slice(6,8);
    $(sig).focus();
  } else if (tecla.which == 37) {
    horizontal = $(this).attr('id').slice(5,6);
    anterior = parseInt(horizontal) - 1;
    ant = '#valor' + anterior + $(this).attr('id').slice(6,8);
    $(ant).focus();
  } else if (tecla.which == 38) {
    vertical = $(this).attr('id').slice(6,8);
    anterior = parseInt(vertical) - 1;
    ant = '#valor' + $(this).attr('id').slice(5,6) + anterior;
    $(ant).focus();
  } else if (tecla.which == 40) {
    vertical = $(this).attr('id').slice(6,8);
    siguiente = parseInt(vertical) + 1;
    sig = '#valor' + $(this).attr('id').slice(5,6) + siguiente;
    $(sig).focus();
  };
});



$("#save_work").click(function(){
  alert("Guardando la Hoja de Tiempo");
  /* var dateObj = new Date();
    //var dateObj = $('#datepicker').datepicker('getDate');
    var dateFrom = $.datepicker.formatDate('mm/dd/yy', dateObj);
    var weekfrom = $.datepicker.iso8601Week(new Date(dateFrom));
    var diasSemana = new Array("Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado");
    var day_select = diasSemana[dateObj.getDay()];
    for (i = 0; i < diasSemana.length; i++) { 
        if (diasSemana[i] == day_select) {
            if (i == 0) {
                var num_day = 6;
                
            } else {
                var num_day = i - 1;
            };
        };
    };
    var f = new Date(); 
    var fech=f.getFullYear()+"-"+(f.getMonth()+1) +"-"+f.getDate() ;
         $("#fechasemana").text( fech );
      
    fecha_inicio = mostrarFecha(dateObj,-num_day);  */
    document.location.href="/timesheet/index/calendar";
});

$("#submit_work1").click(function(){
  alert("Enviando Hoja de Tiempo para Aprobacion");
  var fecha="<?php echo $this->fecha?>";
  var semana="<?php echo $this->semana?>";
  var fecha_calendario = $("#fechasemana").text();
  
  var url="/timesheet/index/enviartimesheet/fecha_calendario/"+fecha_calendario;
  //alert(url);
  $("#carga_nueva").load(url);
 document.location.href="/timesheet/index/calendar";
});

</script>

<script>
  //Funcion para poner el scroll personalizado a la tabla registro
  $('#bodyScroll').ready(function ($) {
    $('#bodyScroll').addClass('scrollContent');
    $('#bodyScroll').perfectScrollbar();
  });
</script>

<script type="text/javascript">        
  $(document).ready(function(){
    $("#submit_work").on("click",function(){
      var fecha_calendario = $("#fechasemana").text();
      //var url1="/timesheet/index/enviartimesheet/fecha_calendario/"+fecha_calendario;
      //$("#carga_nueva").load(url1);
      alert('Enviando Hoja de Tiempo');
      var coment='Envio';
      var uid="<?php echo $this->uid ?>";
      var dni="<?php echo $this->dni ?>";
      var uid_validacion="<?php echo $this->uid ?>";
      var dni_validacion="<?php echo $this->dni ?>";
      var semanaid="<?php echo $this->semana ?>";
      var cargo="<?php echo $this->areaid ?>";
      document.location.href="/timesheet/index/calendar";
      var d=new Date(); 
      var fechacapturada=d.getDate()+ "-" + (d.getMonth() +1) + "-" + d.getFullYear()+','+d.getHours()+':'+d.getMinutes()+':'+d.getSeconds(); 
      //alert(fechacapturada);
      url="/timesheet/index/guardarcomentarioequipo/estado/B/uid/"+uid+'/dni/'+dni+'/semanaid/'+semanaid+'/cargo/'+cargo+'/coment/'+coment+'/uid_validacion/'+uid+'/dni_validacion/'+dni+'/etapa/0'+'/fecha_calendario/'+fecha_calendario+'/fecha/'+fechacapturada;
         
      //alert(url);      
      $.ajax({
        type: "POST",
        url: url,
        data: $(this).serialize(),
        dataType: "html",                                                 
        error: function(){
            alert("error petición ajax load");
        },
        success: function(data){      
            $("#carga_nueva").empty();
            $("#carga_nueva").html(data);           
        }
      });
    });
  })

</script>

<script type="text/javascript">        
  $(document).ready(function(){
    $("#submit_copiar").on("click",function(){
      var fecha_calendario = $("#fechasemana").text();
      var semanaid="<?php echo $this->semana ?>";
      
      url="/timesheet/index/copiartareo/fecha_calendario/"+fecha_calendario+'/semanaid/'+semanaid;
         
      alert(url);      
      $.ajax({
        type: "POST",
        url: url,
        data: $(this).serialize(),
        dataType: "html",                                                 
        error: function(){
            alert("error petición ajax load");
        },
        success: function(data){      
            $("#carga_copiar").empty();
            $("#carga_copiar").html(data);           
        }
      });
    });
  })

</script>