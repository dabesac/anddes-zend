<!--Separando codigo php de la vista y codigo javascript-->

<span style="font-weight:bold;">Actividad</span>
    <script>
        var actividadArray = [];
    </script>

<!--Tranfiriendo los datos de las actividades a un array en javascript-->
<?php
    $actividades_hijos = $this->actividades;

    foreach ($actividades_hijos as $data_tareo_hijos) {
        $tareopersona = new Admin_Model_DbTable_Tareopersona();

        $buscar_tarea=$tareopersona->_getTareoxPersonaxSemanaxActividadidxReplicon($this->uid,$this->dni,$this->semanaid,$data_tareo_hijos['actividad_padre'],$data_tareo_hijos['actividadid'],$data_tareo_hijos['codigo_actividad'],$this->codigo_prop_proy,$this->proyectoid,$data_tareo_hijos['revision']); ?>

        <script>
            actividadObj = {}
            actividadObj = {
                'codigo': '<?php echo $this->codigo_prop_proy; ?>',
                'nombre': "<?php echo $data_tareo_hijos['nombre'] ?>",
                'proyectoid': '<?php echo $this->proyectoid; ?>',
                'categoriaid': '<?php echo $this->categoriaid; ?>',
                'revision': "<?php echo $data_tareo_hijos['revision']; ?>",
                'propuestaid': "<?php echo $data_tareo_hijos['propuestaid']; ?>",
                'actividadid': "<?php echo $data_tareo_hijos['actividadid']; ?>",
                'codigo_actividad': "<?php echo $data_tareo_hijos['codigo_actividad']; ?>",
                'actividad_padre': "<?php echo $data_tareo_hijos['actividad_padre']; ?>",
                'h_propuesta': "<?php echo $data_tareo_hijos['h_propuesta']; ?>"
            }

        </script>        
<?php   if ($buscar_tarea) {?>
            <script>
                actividadObj['estado'] = 'checked';
                actividadArray.push(actividadObj);
            </script>
<?php   } else {?>
            <script>
                actividadObj['estado'] = 'unchecked';
                actividadArray.push(actividadObj);
            </script>
<?php   }
        
    }
?>
<!--Fin de transferencia, apartir de aqui ya no se utiliza php-->

<ul id="lista_actividades" class="nav nav-pills nav-stacked">
    <p>Actividades</p>
</ul>
<ul id="lista_tareas" class="nav nav-pills nav-stacked">
    <p>Tareas</p>
</ul>

<script>
        actividadArray.forEach(function (item) {
            agregar = '';
            if (item.estado == 'checked') {
                agregar = '<li style="padding:5px 5px;color: #667fa0;">' + item.nombre + 
                '<input disabled name="" id="" type = "checkbox" class = "pull-right" value="" checked="true">'  + '</li>';
            } else {
                agregar = '<li style="padding:5px 5px;color: #667fa0;">' + item.nombre + 
                '<input name="tarea_h_' + item.actividadid + '" id="tarea_h_'+ item.actividadid + '" type= "checkbox" class= "pull-right" value="" codigo-prop-proy="' + item.codigo + '" proyectoid="' + item.proyectoid + '" categoriaid="' + item.categoriaid + '" actividadid= "' + item.actividadid + '" revision= "' + item.revision + '" propuestaid= "' + item.propuestaid + '" codigo_actividad= "' + item.codigo_actividad + '">'  + '</li>';
            }
            if (item.actividad_padre == '0') {
                $('#lista_actividades').append(agregar);
            } else {
                $('#lista_tareas').append(agregar);
            }
            
        })
    </script>

<script type="text/javascript">
    $(document).ready(function(){
        $('[name^="tarea_h_"]').click(function(event) {
            if ($(this).is(":checked")) {
                var fecha = $("#fechasemana").text();
                var dato = $(this).attr('codigo_actividad');
                actividadArray.forEach(function (item) {
                    console.log(item.codigo_actividad);
                    if (item.codigo_actividad == dato) {
                        url = "/timesheet/index/guardartareopersona/codigo/" + item.codigo + "/proyectoid/" + item.proyectoid + "/revision/" + item.revision + "/categoriaid/" + item.categoriaid + "/propuestaid/" + item.propuestaid + "/actividadid/" + item.actividadid + "/codigo_actividad/" + item.codigo_actividad + "/actividad_padre/" + item.actividad_padre + "/h_propuesta/" + item.h_propuesta + "/fecha/" + fecha;
                
                        $("#cargar").load(url);
                    }
                })
            }
        });
    }); 


</script>

<div  style="display:none" id="cargar"> </div>
